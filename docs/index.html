<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupl</title><meta name="description" content="Documentation for ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupl"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupl</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupl</h2></div><div class="tsd-panel tsd-typography"><p><a href="https://sonarcloud.io/summary/new_code?id=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupl"><img src="https://sonarcloud.io/api/project_badges/measure?project=ULL-ESIT-INF-DSI-2324_ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupl&metric=alert_status" alt="Quality Gate Status"></a>
<a href="https://coveralls.io/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupl?branch=main"><img src="https://coveralls.io/repos/github/ULL-ESIT-INF-DSI-2324/ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupl/badge.svg?branch=main" alt="Coverage Status"></a></p>
<a id="md:práctica-13---dsikea-api-rest-con-nodeexpress" class="tsd-anchor"></a><h1><a href="#md:práctica-13---dsikea-api-rest-con-nodeexpress">Práctica 13 - DSIkea: API REST con Node/Express</a></h1><a id="md:miembros-del-grupo" class="tsd-anchor"></a><h2><a href="#md:miembros-del-grupo">Miembros del grupo</a></h2><blockquote>
<p>Idaira Reina González</p>
</blockquote>
<blockquote>
<p>Lorenzo Román Luca de Tena</p>
</blockquote>
<blockquote>
<p>Mariam Laaroussi Ramos</p>
</blockquote>
<a id="md:introducción" class="tsd-anchor"></a><h2><a href="#md:introducción">Introducción</a></h2><p>En esta práctica, utilizamos Node.js y Express para implementar operaciones CRUD (Crear, Leer, Actualizar, Borrar) en clientes, proveedores, muebles y transacciones.</p>
<p>Nuestro API permite:
Gestión completa de clientes y proveedores, incluyendo consultas por NIF/CIF.
Manejo de inventario de muebles con opciones de búsqueda detalladas.
Gestión de transacciones, calculando automáticamente los importes y manejando las relaciones entre entidades.
Nos aseguramos de programar defensivamente, considerando posibles errores y situaciones inesperadas, y documentamos exhaustivamente nuestro trabajo.</p>
<a id="md:objetivo" class="tsd-anchor"></a><h2><a href="#md:objetivo">Objetivo</a></h2><p>El objetivo de la práctica es desarrollar un API REST con Node.js y Express para gestionar una tienda de muebles, implementando operaciones CRUD en clientes, proveedores, muebles y transacciones, documentando nuestras decisiones de diseño y realizando pruebas.</p>
<a id="md:models" class="tsd-anchor"></a><h3><a href="#md:models">Models</a></h3><a id="md:customer" class="tsd-anchor"></a><h4><a href="#md:customer">Customer</a></h4><p>Validador de NIF con expresiones regulares:
Se define una función validarNIF que toma un NIF como argumento y devuelve un valor booleano indicando si el NIF es válido o no. Utiliza una expresión regular para validar el formato del NIF, que consiste en 8 dígitos seguidos de una letra.</p>
<pre><code><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-2">validarNIF</span><span class="hl-1">(</span><span class="hl-3">nif</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">): </span><span class="hl-4">boolean</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">regex</span><span class="hl-1"> =</span><span class="hl-6"> /</span><span class="hl-7">^</span><span class="hl-8">[</span><span class="hl-6">0-9</span><span class="hl-8">]</span><span class="hl-9">{8}</span><span class="hl-8">[</span><span class="hl-6">TRWAGMYFPDXBNJZSQVHLCKE</span><span class="hl-8">]</span><span class="hl-7">$</span><span class="hl-6">/</span><span class="hl-0">i</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">regex</span><span class="hl-1">.</span><span class="hl-2">test</span><span class="hl-1">(</span><span class="hl-3">nif</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Definición de la interfaz ICustomer:
Se define una interfaz ICustomer que extiende la interfaz Document de Mongoose. Esta interfaz describe la estructura de los documentos que serán almacenados en la colección de clientes en la base de datos. Incluye propiedades como nombre, apellido, NIF, dirección y teléfono.</p>
<pre><code><span class="hl-0">interface</span><span class="hl-1"> </span><span class="hl-4">ICustomer</span><span class="hl-1"> </span><span class="hl-0">extends</span><span class="hl-1"> </span><span class="hl-4">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">nombre</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">apellido</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">nif</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">direccion</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">telefono</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Definición del esquema del modelo Customer:
Se crea un esquema de Mongoose llamado customerSchema que especifica la estructura y las restricciones de los documentos en la colección de clientes. Cada campo del esquema define el tipo de datos esperado y si es requerido o no. El campo NIF también incluye una validación personalizada utilizando la función validarNIF.</p>
<pre><code><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customerSchema</span><span class="hl-1">: </span><span class="hl-4">Schema</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Schema</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-3">nombre:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">, </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-3">apellido:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">, </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-3">nif:</span><span class="hl-1"> { </span><br/><span class="hl-1">      </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">, </span><br/><span class="hl-1">      </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><br/><span class="hl-1">      </span><span class="hl-3">unique:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><br/><span class="hl-1">        </span><span class="hl-3">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-3">validator:</span><span class="hl-1"> </span><span class="hl-3">validarNIF</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;NIF no válido&#39;</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-3">direccion:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">, </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-3">telefono:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">, </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Creación y Exportación del modelo Customer:
Se utiliza la función model de Mongoose para crear el modelo Customer a partir del esquema definido anteriormente. Este modelo se utilizará para interactuar con la colección de clientes en la base de datos.
Finalmente, el modelo Customer se exporta para que pueda ser utilizado en otros archivos de nuestro proyecto.</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">Customer</span><span class="hl-1"> = </span><span class="hl-2">model</span><span class="hl-1">&lt;</span><span class="hl-4">ICustomer</span><span class="hl-1">&gt;(</span><span class="hl-11">&quot;Customer&quot;</span><span class="hl-1">, </span><span class="hl-3">customerSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<pre><code><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-10">default</span><span class="hl-1"> </span><span class="hl-3">Customer</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<a id="md:provider" class="tsd-anchor"></a><h4><a href="#md:provider">Provider</a></h4><p>Interfaz IProvider:
Se define una interfaz IProvider que extiende la interfaz Document de Mongoose. Esta interfaz describe la estructura de los documentos que serán almacenados en la colección de proveedores en la base de datos. Incluye propiedades como nombre, contacto, dirección, CIF, email (opcional) y móvil (opcional).</p>
<pre><code><span class="hl-0">interface</span><span class="hl-1"> </span><span class="hl-4">IProvider</span><span class="hl-1"> </span><span class="hl-0">extends</span><span class="hl-1"> </span><span class="hl-4">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">name</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">contact</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">address</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">cif</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">email</span><span class="hl-1">?: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">mobilePhone</span><span class="hl-1">?: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Esquema providerSchema:
Se crea un esquema de Mongoose llamado providerSchema que define la estructura y las restricciones de los documentos en la colección de proveedores. Cada campo del esquema especifica el tipo de datos esperado, si es requerido o no, y en algunos casos, se aplican transformaciones o validaciones personalizadas.</p>
<pre><code><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">providerSchema</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Schema</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">name:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">, </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-3">trim:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-3">contact:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">, </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-3">trim:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-3">address:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">, </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-3">trim:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-3">cif:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">unique:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">validator</span><span class="hl-3">:</span><span class="hl-1"> (</span><span class="hl-3">value</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-3">validator</span><span class="hl-1">.</span><span class="hl-2">isLength</span><span class="hl-1">(</span><span class="hl-3">value</span><span class="hl-1">, { </span><span class="hl-3">min:</span><span class="hl-1"> </span><span class="hl-12">9</span><span class="hl-1">, </span><span class="hl-3">max:</span><span class="hl-1"> </span><span class="hl-12">9</span><span class="hl-1"> }),</span><br/><span class="hl-1">      </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;El CIF debe tener 9 carácteres.&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">email:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">trim:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">lowercase:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">validator</span><span class="hl-3">:</span><span class="hl-1"> (</span><span class="hl-3">value</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-3">validator</span><span class="hl-1">.</span><span class="hl-2">isEmail</span><span class="hl-1">(</span><span class="hl-3">value</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Email es inválido.&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">mobilePhone:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">validator</span><span class="hl-3">:</span><span class="hl-1"> (</span><span class="hl-3">value</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-3">validator</span><span class="hl-1">.</span><span class="hl-2">isMobilePhone</span><span class="hl-1">(</span><span class="hl-3">value</span><span class="hl-1">.</span><span class="hl-2">toString</span><span class="hl-1">()),</span><br/><span class="hl-1">      </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Telefono es inválido.&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>En el código anterior podemos ver los validadores.
Validación del CIF:
El campo CIF del esquema incluye una validación personalizada utilizando la función isLength del módulo validator. Se asegura de que el CIF tenga exactamente 9 caracteres.
Validación del email:
El campo email del esquema incluye una validación personalizada utilizando la función isEmail del módulo validator. Se asegura de que el email tenga un formato válido.
Validación del número de teléfono móvil:
El campo mobilePhone del esquema incluye una validación personalizada utilizando la función isMobilePhone del módulo validator. Se asegura de que el número de teléfono móvil tenga un formato válido.
Creación del modelo Provider:
Se utiliza la función model de Mongoose para crear el modelo Provider a partir del esquema providerSchema. Este modelo se utilizará para interactuar con la colección de proveedores en la base de datos.</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">Provider</span><span class="hl-1"> = </span><span class="hl-2">model</span><span class="hl-1">&lt;</span><span class="hl-4">IProvider</span><span class="hl-1">&gt;(</span><span class="hl-11">&#39;Provider&#39;</span><span class="hl-1">, </span><span class="hl-3">providerSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>Exportación del modelo Provider:
Finalmente, el modelo Provider se exporta para que pueda ser utilizado en otros archivos de nuestro proyecto.</p>
<pre><code><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-10">default</span><span class="hl-1"> </span><span class="hl-3">Provider</span><span class="hl-1">;</span>
</code><button>Copy</button></pre>
<a id="md:furniture" class="tsd-anchor"></a><h4><a href="#md:furniture">Furniture</a></h4><p>Definición del esquema de muebles:
Se define una interfaz IFurniture que extiende la interfaz Document de Mongoose. Esta interfaz describe la estructura de los documentos que serán almacenados en la colección de muebles en la base de datos. Incluye propiedades como nombre, descripción, material, dimensiones, precio, stock y color.</p>
<pre><code><span class="hl-0">interface</span><span class="hl-1"> </span><span class="hl-4">IFurniture</span><span class="hl-1"> </span><span class="hl-0">extends</span><span class="hl-1"> </span><span class="hl-4">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">name</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">description</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">material</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">dimensions</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-3">length</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">width</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">height</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">  </span><span class="hl-3">price</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">stock</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">color</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Creación del esquema de la base de datos:
Se crea un esquema de Mongoose llamado furnitureSchema que define la estructura y las restricciones de los documentos en la colección de muebles. Cada campo del esquema especifica el tipo de datos esperado, si es requerido o no, y en algunos casos, se aplican validaciones adicionales.</p>
<pre><code><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furnitureSchema</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Schema</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">name:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">, </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-3">trim:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-3">description:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">, </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-3">trim:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-3">material:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">enum:</span><span class="hl-1"> [</span><span class="hl-11">&quot;plastic&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;fabric&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;metal&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;wood&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;glass&quot;</span><span class="hl-1">,  </span><span class="hl-11">&quot;leather&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">dimensions:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">type:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">length:</span><span class="hl-1"> </span><span class="hl-3">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">width:</span><span class="hl-1"> </span><span class="hl-3">Number</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">height:</span><span class="hl-1"> </span><span class="hl-3">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">price:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">Number</span><span class="hl-1">, </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-3">validate:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">validator</span><span class="hl-3">:</span><span class="hl-1"> (</span><span class="hl-3">value</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-3">value</span><span class="hl-1"> &gt;= </span><span class="hl-12">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Price must be a positive number&#39;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-3">stock:</span><span class="hl-1"> { </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">   },</span><br/><span class="hl-1">  </span><span class="hl-3">color:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">enum:</span><span class="hl-1"> [</span><span class="hl-11">&quot;red&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;purple&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;blue&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;green&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;orange&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;brown&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;yellow&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;black&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;white&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;pink&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Las validaciones que usamos son las siguientes:
Validación del material:
El campo material del esquema incluye una validación utilizando la propiedad enum de Mongoose. Se asegura de que el material especificado sea uno de los valores permitidos: plastic, fabric, metal, wood, glass, leather.</p>
<p>Validación de las dimensiones:
El campo dimensions del esquema incluye un objeto anidado que especifica las dimensiones del mueble (longitud, anchura y altura). Este campo es requerido y debe contener valores numéricos.</p>
<p>Validación del precio:
El campo price del esquema incluye una validación personalizada utilizando una función que verifica que el valor sea un número positivo.</p>
<p>Validación del stock:
El campo stock del esquema indica la cantidad disponible del mueble en el inventario y es requerido.</p>
<p>Validación del color:
El campo color del esquema incluye una validación utilizando la propiedad enum de Mongoose. Se asegura de que el color especificado sea uno de los valores permitidos: red, purple, blue, green, orange, brown, yellow, black, white, pink.</p>
<p>Creación del modelo Furniture:
Se utiliza la función model de Mongoose para crear el modelo Furniture a partir del esquema furnitureSchema. Este modelo se utilizará para interactuar con la colección de muebles en la base de datos.</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">Furniture</span><span class="hl-1"> = </span><span class="hl-2">model</span><span class="hl-1">&lt;</span><span class="hl-4">IFurniture</span><span class="hl-1">&gt;(</span><span class="hl-11">&quot;Furniture&quot;</span><span class="hl-1">, </span><span class="hl-3">furnitureSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:transaction" class="tsd-anchor"></a><h4><a href="#md:transaction">Transaction</a></h4><p>Definición de la interfaz ITransaction:
Se define una interfaz ITransaction que extiende la interfaz Document de Mongoose. Esta interfaz describe la estructura de los documentos que serán almacenados en la colección de transacciones en la base de datos. Incluye propiedades como tipo (Compra o Venta), muebles involucrados, cliente, proveedor, precio y marca de tiempo.</p>
<pre><code><span class="hl-0">interface</span><span class="hl-1"> </span><span class="hl-4">ITransaction</span><span class="hl-1"> </span><span class="hl-0">extends</span><span class="hl-1"> </span><span class="hl-4">Document</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">type</span><span class="hl-1">: </span><span class="hl-11">&quot;Compra&quot;</span><span class="hl-1"> | </span><span class="hl-11">&quot;Venta&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">furniture</span><span class="hl-1">: </span><span class="hl-4">Array</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">    </span><span class="hl-3">furniture</span><span class="hl-1">: </span><span class="hl-0">typeof</span><span class="hl-1"> </span><span class="hl-3">furnitureSchema</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">quantity</span><span class="hl-1">: </span><span class="hl-4">Number</span><span class="hl-1">,</span><br/><span class="hl-1">  }&gt;,</span><br/><span class="hl-1">  </span><span class="hl-3">customer</span><span class="hl-1">: </span><span class="hl-0">typeof</span><span class="hl-1"> </span><span class="hl-3">customerSchema</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">provider</span><span class="hl-1">: </span><span class="hl-0">typeof</span><span class="hl-1"> </span><span class="hl-3">providerSchema</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">price</span><span class="hl-1">: </span><span class="hl-4">Number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-3">timestamp</span><span class="hl-1">: </span><span class="hl-4">Date</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button>Copy</button></pre>
<p>Definición del esquema de transacción:
Se crea un esquema de Mongoose llamado transactionSchema que define la estructura y las restricciones de los documentos en la colección de transacciones. Cada campo del esquema especifica el tipo de datos esperado y, en algunos casos, se aplican validaciones adicionales.</p>
<pre><code><span class="hl-10">export</span><span class="hl-1"> </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">transactionSchema</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Schema</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-3">type:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">String</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-3">enum:</span><span class="hl-1"> [</span><span class="hl-11">&quot;Compra&quot;</span><span class="hl-1">, </span><span class="hl-11">&quot;Venta&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-3">required:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span>
</code><button>Copy</button></pre>
<p>El campo type del esquema incluye una validación utilizando la propiedad enum de Mongoose. Se asegura de que el tipo de transacción especificado sea uno de los valores permitidos: Compra o Venta.</p>
<pre><code><span class="hl-1">  </span><span class="hl-13">furniture</span><span class="hl-1">: [{</span><br/><span class="hl-1">    </span><span class="hl-3">furnitureId:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">Schema</span><span class="hl-1">.</span><span class="hl-3">Types</span><span class="hl-1">.</span><span class="hl-3">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-3">ref:</span><span class="hl-1"> </span><span class="hl-11">&#39;Furniture&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-3">quantity:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">type:</span><span class="hl-1"> </span><span class="hl-3">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }],</span>
</code><button>Copy</button></pre>
<p>El campo furniture del esquema es un array de objetos que contiene los IDs de los muebles involucrados en la transacción y la cantidad de cada uno.</p>
<pre><code><span class="hl-1">  </span><span class="hl-13">customer</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-13">type</span><span class="hl-1">: </span><span class="hl-3">Schema</span><span class="hl-1">.</span><span class="hl-3">Types</span><span class="hl-1">.</span><span class="hl-3">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">ref</span><span class="hl-1">: </span><span class="hl-11">&quot;Customer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-13">provider</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-13">type</span><span class="hl-1">: </span><span class="hl-3">Schema</span><span class="hl-1">.</span><span class="hl-3">Types</span><span class="hl-1">.</span><span class="hl-3">ObjectId</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">ref</span><span class="hl-1">: </span><span class="hl-11">&quot;Provider&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-13">timestamp</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-13">type</span><span class="hl-1">: </span><span class="hl-3">Date</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-10">default</span><span class="hl-1">: </span><span class="hl-3">Date</span><span class="hl-1">.</span><span class="hl-3">now</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">required</span><span class="hl-1">:</span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-13">price</span><span class="hl-1">: {</span><br/><span class="hl-1">    </span><span class="hl-13">type</span><span class="hl-1">: </span><span class="hl-3">Number</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">required</span><span class="hl-1">: </span><span class="hl-0">true</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-13">validate</span><span class="hl-1">: {</span><br/><span class="hl-1">      </span><span class="hl-13">validator</span><span class="hl-1">: (</span><span class="hl-3">value</span><span class="hl-1">: </span><span class="hl-4">number</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-3">value</span><span class="hl-1"> &gt;= </span><span class="hl-12">0</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-13">message</span><span class="hl-1">: </span><span class="hl-11">&quot;Price must be a positive number&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>El campo timestamp del esquema es la marca de tiempo de la transacción y tiene un valor predeterminado de la fecha y hora actual. El campo price es el precio total de la transacción y debe ser un número positivo.</p>
<p>Creación del modelo Transaction:
Se utiliza la función model de Mongoose para crear el modelo Transaction a partir del esquema transactionSchema. Este modelo se utilizará para interactuar con la colección de transacciones en la base de datos.</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">Transaction</span><span class="hl-1"> = </span><span class="hl-2">model</span><span class="hl-1">&lt;</span><span class="hl-4">ITransaction</span><span class="hl-1">&gt;(</span><span class="hl-11">&quot;Transaction&quot;</span><span class="hl-1">, </span><span class="hl-3">transactionSchema</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<a id="md:routers" class="tsd-anchor"></a><h3><a href="#md:routers">Routers</a></h3><a id="md:customerrouter" class="tsd-anchor"></a><h4><a href="#md:customerrouter">CustomerRouter</a></h4><p>Crear un nuevo cliente:</p>
<p>Se define una ruta POST en /customers para crear un nuevo cliente.
Se utiliza un bloque try-catch para manejar cualquier error que ocurra durante la creación del cliente. Si la creación es exitosa, se envía una respuesta con estado 201 (Creado) y se envía el cliente creado como respuesta. Si hay un error, se envía una respuesta con estado 400 (Solicitud incorrecta) con el error.</p>
<pre><code><span class="hl-3">CustomerRouter</span><span class="hl-1">.</span><span class="hl-2">post</span><span class="hl-1">(</span><span class="hl-11">&#39;/customers&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Customer</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">customer</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">201</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">customer</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Leer todos los clientes:</p>
<p>Se define una ruta GET en /customers para leer todos los clientes.
Si se proporciona el parámetro de consulta nif, se busca un cliente por ese número de identificación fiscal.
Si no se proporciona el parámetro nif, se devuelven todos los clientes.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">CustomerRouter</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-11">&#39;/customers&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-14">// si en el query string se encuentra el parámetro nif se busca por nif</span><br/><span class="hl-1">  </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">nif</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Customer</span><span class="hl-1">.</span><span class="hl-2">findOne</span><span class="hl-1">({ </span><span class="hl-3">nif</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Cliente no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-10">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-14">//si el parámetro nif no se encuentra se listan todos los clientes</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customers</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Customer</span><span class="hl-1">.</span><span class="hl-2">find</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">customers</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1">  </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Leer un cliente por ID:</p>
<p>Se define una ruta GET en /customers/id/:id para leer un cliente por su ID.
Se busca el cliente por su ID y se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">CustomerRouter</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-11">&#39;/customers/id/:id&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Customer</span><span class="hl-1">.</span><span class="hl-2">findById</span><span class="hl-1">(</span><span class="hl-3">id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Cliente no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">customer</span><span class="hl-1">); </span><span class="hl-14">// Agregar &#39;return&#39; aquí</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Actualizar un cliente por NIF:</p>
<p>Se define una ruta PATCH en /customers para actualizar un cliente por su NIF.
Se valida que las actualizaciones proporcionadas en el cuerpo de la solicitud sean permitidas.
Se busca el cliente por su NIF y se actualiza con los datos proporcionados en el cuerpo de la solicitud.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">CustomerRouter</span><span class="hl-1">.</span><span class="hl-2">patch</span><span class="hl-1">(</span><span class="hl-11">&#39;/customers/&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">   </span><span class="hl-14">// si en el query string se encuentra el parámetro nif se busca por nif y se actualiza con el cliente nuevo</span><br/><span class="hl-1">  </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">nif</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-14">// comprobar que el cliente del body es válido </span><br/><span class="hl-1">    </span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Customer</span><span class="hl-1">.</span><span class="hl-2">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-3">nif</span><span class="hl-1"> }, </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">, { </span><span class="hl-3">new:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Cliente no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-10">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-14">//si el parámetro nif no se encuentra se devuelve un error</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No se ha proporcionado un NIF&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Actualizar un cliente por ID:</p>
<p>Se define otra ruta PATCH en /customers para actualizar un cliente por su ID. La implementación es similar a la anterior.</p>
<pre><code><span class="hl-3">CustomerRouter</span><span class="hl-1">.</span><span class="hl-2">patch</span><span class="hl-1">(</span><span class="hl-11">&#39;/customers/&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-14">// Si en el query string se encuentra el parámetro nif, se busca por nif y se actualiza con el cliente nuevo</span><br/><span class="hl-1">  </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">nif</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1"> </span><span class="hl-10">as</span><span class="hl-1"> </span><span class="hl-4">string</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-14">// Comprobar que el cliente del body es válido</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">allowedUpdates</span><span class="hl-1"> = [</span><span class="hl-11">&#39;nombre&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;apellido&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;direccion&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;telefono&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">actualUpdates</span><span class="hl-1"> = </span><span class="hl-3">Object</span><span class="hl-1">.</span><span class="hl-2">keys</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-3">actualUpdates</span><span class="hl-1">.</span><span class="hl-2">every</span><span class="hl-1">((</span><span class="hl-3">update</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-3">allowedUpdates</span><span class="hl-1">.</span><span class="hl-2">includes</span><span class="hl-1">(</span><span class="hl-3">update</span><span class="hl-1">));</span><br/><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><br/><span class="hl-1">              </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;Actualización no permitida&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">          });</span><br/><span class="hl-1">      }</span><br/><br/><span class="hl-1">      </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Customer</span><span class="hl-1">.</span><span class="hl-2">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-3">nif</span><span class="hl-1"> }, </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">, { </span><span class="hl-3">new:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> });</span><br/><span class="hl-1">          </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">              </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Cliente no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">          }</span><br/><span class="hl-1">          </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">customer</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">  } </span><span class="hl-10">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-14">// Si el parámetro nif no se encuentra se devuelve un error</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No se ha proporcionado un NIF&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Borrar un cliente por NIF:</p>
<p>Se define una ruta DELETE en /customers/nif/:nif para borrar un cliente por su NIF.
Se busca el cliente por su NIF y se borra de la base de datos.</p>
<pre><code><span class="hl-3">CustomerRouter</span><span class="hl-1">.</span><span class="hl-2">delete</span><span class="hl-1">(</span><span class="hl-11">&#39;/customers/nif/:nif&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">nif</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Customer</span><span class="hl-1">.</span><span class="hl-2">findOneAndDelete</span><span class="hl-1">({ </span><span class="hl-3">nif</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Cliente no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">customer</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Borrar un cliente por ID:</p>
<p>Se define otra ruta DELETE en /customers/id/:id para borrar un cliente por su ID. La implementación es similar a la anterior.</p>
<pre><code><span class="hl-3">CustomerRouter</span><span class="hl-1">.</span><span class="hl-2">delete</span><span class="hl-1">(</span><span class="hl-11">&#39;/customers/id/:id&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Customer</span><span class="hl-1">.</span><span class="hl-2">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-3">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Cliente no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">customer</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:providerrouter" class="tsd-anchor"></a><h4><a href="#md:providerrouter">ProviderRouter</a></h4><p>Crear un nuevo proveedor:</p>
<p>Se define una ruta POST en /providers para crear un nuevo proveedor.
Se crea una instancia del modelo Provider con los datos proporcionados en el cuerpo de la solicitud.
Se utiliza un bloque try-catch para manejar cualquier error que ocurra durante la creación del proveedor. Si la creación es exitosa, se envía una respuesta con estado 201 (Creado) y se envía el proveedor creado como respuesta. Si hay un error, se envía una respuesta con estado 400 (Solicitud incorrecta) con el error.</p>
<pre><code><span class="hl-3">ProvidersRouter</span><span class="hl-1">.</span><span class="hl-2">post</span><span class="hl-1">(</span><span class="hl-11">&#39;/providers&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">provider</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Provider</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">provider</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">201</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">provider</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Leer todos los proveedores:</p>
<p>Se define una ruta GET en /providers para leer todos los proveedores.
Se busca y devuelve todos los proveedores en la base de datos.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">ProvidersRouter</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-11">&#39;/providers&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">providers</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Provider</span><span class="hl-1">.</span><span class="hl-2">find</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">providers</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Leer un proveedor por CIF:</p>
<p>Se define una ruta GET en /providers/:cif para leer un proveedor por su CIF (Código de Identificación Fiscal).
Se busca el proveedor por su CIF y se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">ProvidersRouter</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-11">&#39;/providers/:cif&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">cif</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">cif</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">provider</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Provider</span><span class="hl-1">.</span><span class="hl-2">findOne</span><span class="hl-1">({ </span><span class="hl-3">cif</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">provider</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Proveedor no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">provider</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span>
</code><button>Copy</button></pre>
<p>Leer un proveedor por ID:</p>
<p>Se define una ruta GET en /providers/id/:id para leer un proveedor por su ID.
Se busca el proveedor por su ID y se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">ProvidersRouter</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-11">&#39;/providers/id/:id&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">provider</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Provider</span><span class="hl-1">.</span><span class="hl-2">findById</span><span class="hl-1">(</span><span class="hl-3">id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">provider</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Proveedor no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">provider</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span>
</code><button>Copy</button></pre>
<p>Actualizar un proveedor por CIF:</p>
<p>Se define una ruta PATCH en /providers para actualizar un proveedor por su CIF.
Se valida que las actualizaciones proporcionadas en el cuerpo de la solicitud sean permitidas.
Se busca el proveedor por su CIF y se actualiza con los datos proporcionados en el cuerpo de la solicitud.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">ProvidersRouter</span><span class="hl-1">.</span><span class="hl-2">patch</span><span class="hl-1">(</span><span class="hl-11">&#39;/providers&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">cif</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;Se debe proporcionar un CIF&#39;</span><span class="hl-1">,});</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">Updates</span><span class="hl-1"> = [</span><span class="hl-11">&#39;name&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;contact&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;address&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;email&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;mobilePhone&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">UpdateExistente</span><span class="hl-1"> = </span><span class="hl-3">Object</span><span class="hl-1">.</span><span class="hl-2">keys</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">isValidUpdate</span><span class="hl-1"> = </span><span class="hl-3">UpdateExistente</span><span class="hl-1">.</span><span class="hl-2">every</span><span class="hl-1">((</span><span class="hl-3">update</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-3">Updates</span><span class="hl-1">.</span><span class="hl-2">includes</span><span class="hl-1">(</span><span class="hl-3">update</span><span class="hl-1">));</span><br/><br/><span class="hl-1">  </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">isValidUpdate</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;Actualización no permitida&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">provider</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Provider</span><span class="hl-1">.</span><span class="hl-2">findOneAndUpdate</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-3">cif:</span><span class="hl-1"> </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">cif</span><span class="hl-1">.</span><span class="hl-2">toString</span><span class="hl-1">() },</span><br/><span class="hl-1">        </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">,</span><br/><span class="hl-1">        { </span><span class="hl-3">new:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-3">runValidators:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> }</span><br/><span class="hl-1">    );</span><br/><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">provider</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">provider</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Borrar un proveedor por CIF:</p>
<p>Se define una ruta DELETE en /providers/:cif para borrar un proveedor por su CIF.
Se busca y borra el proveedor por su CIF en la base de datos.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">ProvidersRouter</span><span class="hl-1">.</span><span class="hl-2">delete</span><span class="hl-1">(</span><span class="hl-11">&#39;/providers/:cif&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">cif</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;Se debe proporcionar un CIF&#39;</span><span class="hl-1">,});</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">cif</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">cif</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">provider</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Provider</span><span class="hl-1">.</span><span class="hl-2">findOneAndDelete</span><span class="hl-1">({ </span><span class="hl-3">cif</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">provider</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Proveedor no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">provider</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Borrar un proveedor por ID:</p>
<p>Se define una ruta DELETE en /providers/:id para borrar un proveedor por su ID. La implementación es similar a la anterior.</p>
<pre><code><span class="hl-3">ProvidersRouter</span><span class="hl-1">.</span><span class="hl-2">delete</span><span class="hl-1">(</span><span class="hl-11">&#39;/providers/:id&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;Se debe proporcionar un ID&#39;</span><span class="hl-1">,});</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">provider</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Provider</span><span class="hl-1">.</span><span class="hl-2">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-3">id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">provider</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Proveedor no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">provider</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span>
</code><button>Copy</button></pre>
<a id="md:furniturerouter" class="tsd-anchor"></a><h4><a href="#md:furniturerouter">FurnitureRouter</a></h4><p>Crear un nuevo mueble:</p>
<p>Se define una ruta POST en /furnitures para crear un nuevo mueble.
Se crea una instancia del modelo Furniture con los datos proporcionados en el cuerpo de la solicitud.
Se utiliza un bloque try-catch para manejar cualquier error que ocurra durante la creación del mueble. Si la creación es exitosa, se envía una respuesta con estado 201 (Creado) y se envía el mueble creado como respuesta. Si hay un error, se envía una respuesta con estado 400 (Solicitud incorrecta) con el error.</p>
<pre><code><span class="hl-3">FurnitureRouter</span><span class="hl-1">.</span><span class="hl-2">post</span><span class="hl-1">(</span><span class="hl-11">&#39;/furnitures&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Furniture</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">furniture</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">201</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Leer todos los muebles:</p>
<p>Se define una ruta GET en /furnitures para leer todos los muebles.
Se filtran los muebles según los parámetros proporcionados en el query string, como material, nombre o descripción.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">FurnitureRouter</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-11">&#39;/furnitures&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">   </span><span class="hl-14">//si en el query se encuentra el parámetro material o nombre o descripcion se busca por esos campos</span><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">material</span><span class="hl-1"> || </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nombre</span><span class="hl-1"> || </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">descripcion</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">material</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">material</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">nombre</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nombre</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">descripcion</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">descripcion</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">find</span><span class="hl-1">({ </span><span class="hl-3">material</span><span class="hl-1">, </span><span class="hl-3">nombre</span><span class="hl-1">, </span><span class="hl-3">descripcion</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    } </span><span class="hl-14">//si se incluye el parametro id se busca por id de la base de datos</span><br/><span class="hl-1">    </span><span class="hl-10">else</span><span class="hl-1"> </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findById</span><span class="hl-1">({ </span><span class="hl-3">id</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Error en la busqueda por id&#39;</span><span class="hl-1">}); </span><br/><span class="hl-1">      }</span><br/><span class="hl-1">  } </span><span class="hl-10">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-14">//si no se encuentra ningun parametro se listan todos los muebles</span><br/><span class="hl-1">      </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furnitures</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">find</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furnitures</span><span class="hl-1">);</span><br/><span class="hl-1">      } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1">  </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Leer un mueble por ID:</p>
<p>Se define una ruta GET en /furnitures/:id para leer un mueble por su ID.
Se busca el mueble por su ID y se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">FurnitureRouter</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-11">&#39;/furnitures/:id&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findById</span><span class="hl-1">(</span><span class="hl-3">id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}); </span>
</code><button>Copy</button></pre>
<p>Actualizar un mueble por ID:</p>
<p>Se define una ruta PATCH en /furnitures/id/:id para actualizar un mueble por su ID.
Se busca y actualiza el mueble por su ID con los datos proporcionados en el cuerpo de la solicitud.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">FurnitureRouter</span><span class="hl-1">.</span><span class="hl-2">patch</span><span class="hl-1">(</span><span class="hl-11">&#39;/furnitures/id/:id&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">   </span><span class="hl-14">// Se actualiza el mueble por id, el mueble se encuentra en el body</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findByIdAndUpdate</span><span class="hl-1">({</span><span class="hl-3">id</span><span class="hl-1">}, </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">, { </span><span class="hl-3">new:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;fallo en la busqueda del id&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Borrar un mueble por ID:</p>
<p>Se define una ruta DELETE en /furnitures/id/:id para borrar un mueble por su ID.
Se busca y borra el mueble por su ID en la base de datos.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">FurnitureRouter</span><span class="hl-1">.</span><span class="hl-2">delete</span><span class="hl-1">(</span><span class="hl-11">&#39;/furnitures/id/:id&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-14">// buscar un mueble por id y si existe eliminarlo</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-3">id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Actualizar un mueble por query string (campos flexibles):</p>
<p>Se define una ruta PATCH en /furnitures/ para actualizar un mueble según los parámetros proporcionados en el query string, como ID, nombre o material.
Se valida la presencia de los parámetros necesarios y se actualiza el mueble con los datos proporcionados.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">FurnitureRouter</span><span class="hl-1">.</span><span class="hl-2">patch</span><span class="hl-1">(</span><span class="hl-11">&#39;/furnitures/&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-14">//si en el query string se encuentra el parámetro id se busca por id y se actualiza con el mueble nuevo</span><br/><span class="hl-1">  </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findByIdAndUpdate</span><span class="hl-1">({</span><span class="hl-3">id</span><span class="hl-1">}, </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">, { </span><span class="hl-3">new:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;fallo en la busqueda del id&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-14">// si se encuentra el parámetro nombre se busca por nombre y se actualiza con el mueble nuevo</span><br/><span class="hl-1">  </span><span class="hl-10">else</span><span class="hl-1"> </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">nombre</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nombre</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-3">nombre</span><span class="hl-1"> }, </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">, { </span><span class="hl-3">new:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-14">// si se encuentra el parámetro material se busca por material y se actualiza con el mueble nuevo</span><br/><span class="hl-1">  </span><span class="hl-10">else</span><span class="hl-1"> </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">material</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">material</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">material</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findOneAndUpdate</span><span class="hl-1">({ </span><span class="hl-3">material</span><span class="hl-1"> }, </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">, { </span><span class="hl-3">new:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-14">// si no se encuentra ningun parametro se devuelve un error</span><br/><span class="hl-1">  </span><span class="hl-10">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No se ha encontrado el mueble&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Borrar un mueble por query string (campos flexibles):</p>
<p>Se define una ruta DELETE en /furnitures/query para borrar un mueble según los parámetros proporcionados en el query string, como ID, nombre o material.
Se valida la presencia de los parámetros necesarios y se borra el mueble correspondiente.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">FurnitureRouter</span><span class="hl-1">.</span><span class="hl-2">delete</span><span class="hl-1">(</span><span class="hl-11">&#39;/furnitures/query&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-14">//si en el query string se encuentra el parámetro id se busca por id y se actualiza con el mueble nuevo</span><br/><span class="hl-1">  </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findByIdAndDelete</span><span class="hl-1">({</span><span class="hl-3">id</span><span class="hl-1">});</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;fallo en la busqueda del id&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-14">// si se encuentra el parámetro nombre se busca por nombre y se actualiza con el mueble nuevo</span><br/><span class="hl-1">  </span><span class="hl-10">else</span><span class="hl-1"> </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nombre</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">nombre</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nombre</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findOneAndDelete</span><span class="hl-1">({ </span><span class="hl-3">nombre</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-14">// si se encuentra el parámetro material se busca por material y se actualiza con el mueble nuevo</span><br/><span class="hl-1">  </span><span class="hl-10">else</span><span class="hl-1"> </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">material</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">material</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">material</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findOneAndDelete</span><span class="hl-1">({ </span><span class="hl-3">material</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Mueble no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">error</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-14">// si no se encuentra ningun parametro se devuelve un error</span><br/><span class="hl-1">  </span><span class="hl-10">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No se ha encontrado el mueble&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:transactionrouter" class="tsd-anchor"></a><h4><a href="#md:transactionrouter">TransactionRouter</a></h4><p>Leer todas las transacciones:</p>
<p>Se define una ruta GET en /transactions para leer todas las transacciones.
Se filtran las transacciones según los parámetros proporcionados en el query string, como nif, date, type o id.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">TransactionRouter</span><span class="hl-1">.</span><span class="hl-2">get</span><span class="hl-1">(</span><span class="hl-11">&#39;/transactions&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><br/><span class="hl-14">// si se incluye un query string en el que aparezca el parámetro nif se pusca por ese nif, si aparece el parámetro date este tendrá dos fechas y deberá buscar las transacciones entre esas dos fechas </span><br/><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">nif</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Customer</span><span class="hl-1">.</span><span class="hl-2">findOne</span><span class="hl-1">({ </span><span class="hl-3">nif</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Cliente no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">transactions</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Transaction</span><span class="hl-1">.</span><span class="hl-2">find</span><span class="hl-1">({</span><span class="hl-3">customer:</span><span class="hl-1"> </span><span class="hl-3">customer</span><span class="hl-1">.</span><span class="hl-3">_id</span><span class="hl-1">});</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">transactions</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No existen transacciones&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">    } </span><span class="hl-14">// debe buscar tambien en la base de datos de providers</span><br/><span class="hl-1">  } </span><span class="hl-10">else</span><span class="hl-1"> </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">nif</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">nif</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">provider</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Provider</span><span class="hl-1">.</span><span class="hl-2">findOne</span><span class="hl-1">({ </span><span class="hl-3">nif</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">provider</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Proveedor no encontrado&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">transactions</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Transaction</span><span class="hl-1">.</span><span class="hl-2">find</span><span class="hl-1">({</span><span class="hl-3">provider:</span><span class="hl-1"> </span><span class="hl-3">provider</span><span class="hl-1">.</span><span class="hl-3">_id</span><span class="hl-1">});</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">transactions</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No existen transacciones&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-10">else</span><span class="hl-1"> </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">date</span><span class="hl-1">){</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">date</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">date</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">transactions</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Transaction</span><span class="hl-1">.</span><span class="hl-2">find</span><span class="hl-1">({</span><span class="hl-3">date</span><span class="hl-1">});</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">transactions</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No existen transacciones&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-14">// si en el query se incluye un parámetro tipo se buscará por ese tipo</span><br/><span class="hl-1">  </span><span class="hl-10">else</span><span class="hl-1"> </span><span class="hl-10">if</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">type</span><span class="hl-1">){</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">type</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">type</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">transactions</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Transaction</span><span class="hl-1">.</span><span class="hl-2">find</span><span class="hl-1">({ </span><span class="hl-3">type</span><span class="hl-1"> });</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">transactions</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> ( </span><span class="hl-3">error</span><span class="hl-1"> ){</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No existen transacciones de ese tipo&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  } </span><span class="hl-14">// si se incluye el parámetro id se buscará por el id de la base de datos</span><br/><span class="hl-1">  </span><span class="hl-10">else</span><span class="hl-1"> </span><span class="hl-10">if</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">){</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">query</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">transactions</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Transaction</span><span class="hl-1">.</span><span class="hl-2">findById</span><span class="hl-1">({ </span><span class="hl-3">id</span><span class="hl-1"> })</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">transactions</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">){</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No existen transacciones con ese id&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><br/><span class="hl-1">  } </span><span class="hl-10">else</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">transactions</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Transaction</span><span class="hl-1">.</span><span class="hl-2">find</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">transactions</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No existen transacciones&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Crear una nueva transacción:</p>
<p>Se define una ruta POST en /transactions para crear una nueva transacción.
Se valida que el cliente, el proveedor y los muebles asociados existan en la base de datos y que haya suficiente stock de los muebles.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">TransactionRouter</span><span class="hl-1">.</span><span class="hl-2">post</span><span class="hl-1">(</span><span class="hl-11">&#39;/transactions&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-14">//para crear una transaccion se debe comprobar que el nif existe en la base de datos de clientes y proveedores, se debe de comprobar que el id de los muebles existen en la base de datos de muebles además de que hay stock de los mismos</span><br/><span class="hl-1">  </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">transaction</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Transaction</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Customer</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">.</span><span class="hl-3">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">provider</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Provider</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">.</span><span class="hl-3">provider</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-2">Furniture</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">.</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">customer</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">provider</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">furniture</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">furniture</span><span class="hl-1">.</span><span class="hl-3">stock</span><span class="hl-1"> &lt; </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">.</span><span class="hl-3">furniture</span><span class="hl-1">.</span><span class="hl-3">quantity</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No hay suficiente stock&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">transaction</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">201</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">transaction</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({</span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;No se ha podido crear la transacción&#39;</span><span class="hl-1">});</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">} </span><br/><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>Actualizar una transacción por ID:</p>
<p>Se define una ruta PATCH en /transactions/:id para actualizar una transacción por su ID.
Se valida que las actualizaciones sean permitidas y se aplican al documento de transacción.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">TransactionRouter</span><span class="hl-1">.</span><span class="hl-2">patch</span><span class="hl-1">(</span><span class="hl-11">&#39;/transactions/:id&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-14">// Validar las actualizaciones permitidas</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">updates</span><span class="hl-1"> = </span><span class="hl-3">Object</span><span class="hl-1">.</span><span class="hl-2">keys</span><span class="hl-1">(</span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">allowedFields</span><span class="hl-1"> = [</span><span class="hl-11">&#39;type&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;furniture&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;customer&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;provider&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;price&#39;</span><span class="hl-1">, </span><span class="hl-11">&#39;timestamp&#39;</span><span class="hl-1">];</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">isUpdateAllowed</span><span class="hl-1"> = </span><span class="hl-3">updates</span><span class="hl-1">.</span><span class="hl-2">every</span><span class="hl-1">((</span><span class="hl-3">update</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> </span><span class="hl-3">allowedFields</span><span class="hl-1">.</span><span class="hl-2">includes</span><span class="hl-1">(</span><span class="hl-3">update</span><span class="hl-1">));</span><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">isUpdateAllowed</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;No se pudo realizar la actualización&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-14">// Obtener el ID de la transacción y los campos de actualización</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">updatedFields</span><span class="hl-1">: { [</span><span class="hl-3">key</span><span class="hl-1">: </span><span class="hl-4">string</span><span class="hl-1">]: </span><span class="hl-4">any</span><span class="hl-1"> } = {};</span><br/><span class="hl-1">    </span><span class="hl-10">for</span><span class="hl-1"> (</span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">key</span><span class="hl-1"> </span><span class="hl-0">of</span><span class="hl-1"> </span><span class="hl-3">updates</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">updatedFields</span><span class="hl-1">[</span><span class="hl-3">key</span><span class="hl-1">] = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">body</span><span class="hl-1">[</span><span class="hl-3">key</span><span class="hl-1">];</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-14">// Actualizar la transacción</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">transaction</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Transaction</span><span class="hl-1">.</span><span class="hl-2">findOne</span><span class="hl-1">({ </span><span class="hl-3">_id:</span><span class="hl-1"> </span><span class="hl-3">id</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">transaction</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;La transacción no existe&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-10">for</span><span class="hl-1"> (</span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">key</span><span class="hl-1"> </span><span class="hl-0">in</span><span class="hl-1"> </span><span class="hl-3">updatedFields</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-14">// Asegurar que la clave es válida y hacer una aserción de tipo</span><br/><span class="hl-1">      </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-4">Object</span><span class="hl-1">.</span><span class="hl-3">prototype</span><span class="hl-1">.</span><span class="hl-3">hasOwnProperty</span><span class="hl-1">.</span><span class="hl-2">call</span><span class="hl-1">(</span><span class="hl-3">updatedFields</span><span class="hl-1">, </span><span class="hl-3">key</span><span class="hl-1">)) {</span><br/><span class="hl-1">        (</span><span class="hl-3">transaction</span><span class="hl-1"> </span><span class="hl-10">as</span><span class="hl-1"> </span><span class="hl-4">any</span><span class="hl-1">)[</span><span class="hl-3">key</span><span class="hl-1">] = </span><span class="hl-3">updatedFields</span><span class="hl-1">[</span><span class="hl-3">key</span><span class="hl-1">];</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">transaction</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><br/><span class="hl-1">    </span><span class="hl-14">// Manejar la respuesta</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">200</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">(</span><span class="hl-3">transaction</span><span class="hl-1">);</span><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-14">// Manejar errores</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;Hubo un error tratando de modificar la transacción&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Borrar una transacción por ID:</p>
<p>Se define una ruta DELETE en /transactions/:id para borrar una transacción por su ID.
Se busca la transacción por su ID y se verifican los participantes asociados (cliente o proveedor).
Se manipula el stock de los muebles dependiendo del tipo de transacción.
Se manejan los posibles errores con bloques try-catch.</p>
<pre><code><span class="hl-3">TransactionRouter</span><span class="hl-1">.</span><span class="hl-2">delete</span><span class="hl-1">(</span><span class="hl-11">&#39;/transactions/:id&#39;</span><span class="hl-1">, </span><span class="hl-0">async</span><span class="hl-1"> (</span><span class="hl-3">req</span><span class="hl-1">: </span><span class="hl-4">Request</span><span class="hl-1">, </span><span class="hl-3">res</span><span class="hl-1">: </span><span class="hl-4">Response</span><span class="hl-1">) </span><span class="hl-0">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-10">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-14">// Filtrado de la transacción</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">id</span><span class="hl-1"> = </span><span class="hl-3">req</span><span class="hl-1">.</span><span class="hl-3">params</span><span class="hl-1">.</span><span class="hl-3">id</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">filter</span><span class="hl-1"> = { </span><span class="hl-3">_id:</span><span class="hl-1"> </span><span class="hl-3">id</span><span class="hl-1"> };</span><br/><br/><span class="hl-1">    </span><span class="hl-14">// Búsqueda de la transacción</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">transaction</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Transaction</span><span class="hl-1">.</span><span class="hl-2">findById</span><span class="hl-1">(</span><span class="hl-3">id</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">transaction</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;La transacción no existe&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-14">// Verificación de existencia del participante</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">customer</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Customer</span><span class="hl-1">.</span><span class="hl-2">findById</span><span class="hl-1">(</span><span class="hl-3">transaction</span><span class="hl-1">.</span><span class="hl-3">customer</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">provider</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Provider</span><span class="hl-1">.</span><span class="hl-2">findById</span><span class="hl-1">(</span><span class="hl-3">transaction</span><span class="hl-1">.</span><span class="hl-3">provider</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">customer</span><span class="hl-1"> &amp;&amp; !</span><span class="hl-3">provider</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;El cliente o proveedor asociado a la transacción no existe&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-14">// Verificación del tipo de transacción y manipulación de stock</span><br/><span class="hl-1">    </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">transaction</span><span class="hl-1">.</span><span class="hl-3">type</span><span class="hl-1"> === </span><span class="hl-11">&#39;Venta&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-3">customer</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-14">// Se aumenta el stock para los muebles vendidos al cliente</span><br/><span class="hl-1">      </span><span class="hl-10">for</span><span class="hl-1"> (</span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furnitureData</span><span class="hl-1"> </span><span class="hl-0">of</span><span class="hl-1"> </span><span class="hl-3">transaction</span><span class="hl-1">.</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findById</span><span class="hl-1">(</span><span class="hl-3">furnitureData</span><span class="hl-1">.</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;Uno de los muebles asociados a la transacción no existe&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-3">furniture</span><span class="hl-1">.</span><span class="hl-3">stock</span><span class="hl-1"> += </span><span class="hl-3">furnitureData</span><span class="hl-1">.</span><span class="hl-3">quantity</span><span class="hl-1">.</span><span class="hl-2">valueOf</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">furniture</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    } </span><span class="hl-10">else</span><span class="hl-1"> </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">transaction</span><span class="hl-1">.</span><span class="hl-3">type</span><span class="hl-1"> === </span><span class="hl-11">&#39;Compra&#39;</span><span class="hl-1"> &amp;&amp; </span><span class="hl-3">provider</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-14">// Se disminuye el stock para los muebles comprados al proveedor</span><br/><span class="hl-1">      </span><span class="hl-10">for</span><span class="hl-1"> (</span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furnitureData</span><span class="hl-1"> </span><span class="hl-0">of</span><span class="hl-1"> </span><span class="hl-3">transaction</span><span class="hl-1">.</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-5">furniture</span><span class="hl-1"> = </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Furniture</span><span class="hl-1">.</span><span class="hl-2">findById</span><span class="hl-1">(</span><span class="hl-3">furnitureData</span><span class="hl-1">.</span><span class="hl-3">furniture</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-10">if</span><span class="hl-1"> (!</span><span class="hl-3">furniture</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">404</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;Uno de los muebles asociados a la transacción no existe&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-3">furniture</span><span class="hl-1">.</span><span class="hl-3">stock</span><span class="hl-1"> &lt; </span><span class="hl-3">furnitureData</span><span class="hl-1">.</span><span class="hl-3">quantity</span><span class="hl-1">.</span><span class="hl-2">valueOf</span><span class="hl-1">()) {</span><br/><span class="hl-1">          </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">400</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;No hay suficiente stock para realizar la eliminación&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">        </span><span class="hl-3">furniture</span><span class="hl-1">.</span><span class="hl-3">stock</span><span class="hl-1"> -= </span><span class="hl-3">furnitureData</span><span class="hl-1">.</span><span class="hl-3">quantity</span><span class="hl-1">.</span><span class="hl-2">valueOf</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">furniture</span><span class="hl-1">.</span><span class="hl-2">save</span><span class="hl-1">();</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-14">// Eliminación de la transacción</span><br/><span class="hl-1">    </span><span class="hl-10">await</span><span class="hl-1"> </span><span class="hl-3">Transaction</span><span class="hl-1">.</span><span class="hl-2">findByIdAndDelete</span><span class="hl-1">(</span><span class="hl-3">id</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-14">// Respuesta HTTP en caso de éxito</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">200</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">message:</span><span class="hl-1"> </span><span class="hl-11">&#39;Transacción eliminada exitosamente&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">  } </span><span class="hl-10">catch</span><span class="hl-1"> (</span><span class="hl-3">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-14">// Respuesta HTTP en caso de error</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-3">res</span><span class="hl-1">.</span><span class="hl-2">status</span><span class="hl-1">(</span><span class="hl-12">500</span><span class="hl-1">).</span><span class="hl-2">send</span><span class="hl-1">({ </span><span class="hl-3">error:</span><span class="hl-1"> </span><span class="hl-11">&#39;Hubo un error tratando de eliminar la transacción&#39;</span><span class="hl-1"> });</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:conclusión" class="tsd-anchor"></a><h2><a href="#md:conclusión">Conclusión</a></h2><p>En conclusión, la práctica nos brindó la oportunidad de aplicar nuestros conocimientos en el desarrollo de sistemas informáticos mediante la implementación de un API REST para una tienda de muebles. Utilizando Node.js y Express, logramos diseñar un sistema completo que permite la gestión eficiente de clientes, proveedores, inventario de muebles y transacciones. A lo largo del proceso, aprendimos a programar defensivamente, documentar nuestras decisiones de diseño y realizar pruebas exhaustivas para garantizar la calidad del código. Esta experiencia nos ha preparado para enfrentar desafíos similares en proyectos futuros y nos ha brindado una comprensión más profunda del desarrollo de sistemas informáticos en el mundo real.</p>
<a id="md:dificultades" class="tsd-anchor"></a><h2><a href="#md:dificultades">Dificultades</a></h2><p>Durante el desarrollo de nuestro proyecto, nos enfrentamos a varias dificultades que pusieron a prueba nuestra capacidad para resolver problemas y adaptarnos a situaciones imprevistas. Una de las principales dificultades fue el problema con la VPN al ejecutar nuestras pruebas. En un principio, no nos dimos cuenta de cómo esta conexión externa podía afectar el rendimiento de nuestras pruebas, lo que resultó en retrasos y desconexiones inesperadas. Fue un recordatorio importante de la necesidad de entender completamente nuestro entorno de trabajo y anticipar posibles obstáculos.</p>
<p>Otro desafío significativo fue el error del servidor interno, que nos dejó perplejos durante varias horas. No pudimos determinar la causa exacta del problema, lo que nos llevó a revisar meticulosamente nuestro código y configuración en busca de posibles errores. Finalmente, el servidor volvió a funcionar sin explicación aparente, lo que nos dejó con una sensación de alivio y una lección aprendida sobre la importancia de la paciencia y la persistencia en el desarrollo de software.</p>
<a id="md:bibliografía" class="tsd-anchor"></a><h2><a href="#md:bibliografía">Bibliografía</a></h2><blockquote>
<p>Práctica 13 - DSIkea: API REST con Node/Express. (n.d.). Desarrollo De Sistemas Informáticos - Grado En Ingeniería Informática - ULL. <a href="https://ull-esit-inf-dsi-2324.github.io/prct13-DSIkea-api/">https://ull-esit-inf-dsi-2324.github.io/prct13-DSIkea-api/</a></p>
</blockquote>
<blockquote>
<p>Cloud application hosting for developers | Render. (n.d.). Cloud Application Hosting for Developers | Render. <a href="https://dashboard.render.com/">https://dashboard.render.com/</a></p>
</blockquote>
<blockquote>
<p>Projects | Cloud: MongoDB Cloud. (n.d.). <a href="https://cloud.mongodb.com/v2#/org/663b4e5f66e117266a136106/projects">https://cloud.mongodb.com/v2#/org/663b4e5f66e117266a136106/projects</a></p>
</blockquote>
<blockquote>
<p>How do I use SuperTest in my Node.js TypeScript project? (n.d.). Stack Overflow. <a href="https://stackoverflow.com/questions/76596884/how-do-i-use-supertest-in-my-node-js-typescript-project">https://stackoverflow.com/questions/76596884/how-do-i-use-supertest-in-my-node-js-typescript-project</a></p>
</blockquote>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-index-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><h4 class="uppercase">Member Visibility</h4><form><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-private" name="private"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Private</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></form></div><div class="tsd-theme-toggle"><h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:práctica-13---dsikea-api-rest-con-nodeexpress"><span>Práctica 13 -<wbr/> DSIkea: API REST con <wbr/>Node/<wbr/>Express</span></a><ul><li><a href="#md:miembros-del-grupo"><span>Miembros del grupo</span></a></li><li><a href="#md:introducción"><span>Introducción</span></a></li><li><a href="#md:objetivo"><span>Objetivo</span></a></li><li><ul><li><a href="#md:models"><span>Models</span></a></li><li><ul><li><a href="#md:customer"><span>Customer</span></a></li><li><a href="#md:provider"><span>Provider</span></a></li><li><a href="#md:furniture"><span>Furniture</span></a></li><li><a href="#md:transaction"><span>Transaction</span></a></li></ul></li><li><a href="#md:routers"><span>Routers</span></a></li><li><ul><li><a href="#md:customerrouter"><span>Customer<wbr/>Router</span></a></li><li><a href="#md:providerrouter"><span>Provider<wbr/>Router</span></a></li><li><a href="#md:furniturerouter"><span>Furniture<wbr/>Router</span></a></li><li><a href="#md:transactionrouter"><span>Transaction<wbr/>Router</span></a></li></ul></li></ul></li><li><a href="#md:conclusión"><span>Conclusión</span></a></li><li><a href="#md:dificultades"><span>Dificultades</span></a></li><li><a href="#md:bibliografía"><span>Bibliografía</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>ull-esit-inf-dsi-23-24-prct13-dsikea-api-groupl</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>